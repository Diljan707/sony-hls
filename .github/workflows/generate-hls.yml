name: Fast Disney HLS Proxy

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install ffmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: Fetch Disney stream & repackage
        run: |
          mkdir -p fast
          ffmpeg -i "http://103.182.170.32:8888/play/a04g" \
            -c copy \
            -map 0 \
            -f hls \
            -hls_time 3 \
            -hls_list_size 6 \
            -hls_flags delete_segments+append_list \
            fast/disney.m3u8

      - name: Push to repo
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "auto update fast disney"
          file_pattern: fast/*
