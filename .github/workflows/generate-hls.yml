addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

const ORIGINAL_STREAM = "http://103.182.170.32:8888/play/a04g"

async function handleRequest(request) {
  const url = new URL(request.url)

  // Direct fetch original stream
  const response = await fetch(ORIGINAL_STREAM, {
    method: request.method,
    headers: {
      "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/121.0.0.0 Safari/537.36",
      "Accept": "*/*",
      "Referer": ORIGINAL_STREAM,
      "Origin": ORIGINAL_STREAM,
      "Host": "103.182.170.32"
    }
  })

  // Set headers for CORS & no-cache
  const newHeaders = new Headers(response.headers)
  newHeaders.set("Access-Control-Allow-Origin", "*")
  newHeaders.set("Cache-Control", "no-cache")
  newHeaders.set("Pragma", "no-cache")

  return new Response(response.body, {
    status: response.status,
    headers: newHeaders
  })
}
