name: Generate PTC Punjabi HLS

on:
  schedule:
    - cron: "*/5 * * * *"   # every 5 minutes
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install FFmpeg
        run: |
          sudo apt update
          sudo apt install -y ffmpeg

      - name: Create output folder
        run: mkdir -p hls/ptc

      - name: Run FFmpeg for PTC Punjabi
        run: |
          ffmpeg -i "http://103.182.170.32:8888/play/a04g" \
          -c:v copy -c:a copy \
          -hls_time 4 \
          -hls_list_size 5 \
          -hls_flags delete_segments \
          -hls_segment_filename "hls/ptc/segment_%03d.ts" \
          hls/ptc/playlist.m3u8

      - name: Upload HLS to repo
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add .
          git commit -m "Updated PTC Punjabi HLS"
          git push
